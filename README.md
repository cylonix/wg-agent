# Wg-Agent

A WireGuard termination gateway written in Rust. Supports multiple VRFs and VXLAN tunnel to the next stage FW or router.

![Wg-Agent](./project.jpg)

## How to build wg-agent

### Generate api

```bash
make generate
```

### Compile

```bash
make build
```

### Optional steps

#### How generate rust code from c code?

```bash
bindgen wrapper.h --whitelist-function 'ipc_.*|curve.*' --whitelist-type 'wgdevice|wgdevice_flag_wg_peer_flag_' --rustified-enum ".*" -- -I ~/wg-manager/wg-sys/wireguard-tools/src/uapi/linux  > src/lib.rs
```

#### How to run test with output

```bash
 cargo test test_base58_curve25519 -- --show-output
```

## Code structure

- wg-sys: generated by the bindgen, don't change it manually
- wg-rs: wrapper for wg-sys, for wg
- wg-mgr-api: generated by swagger, a lib like the wg-sys, used by the wg-mgr-rs
- wg-mgr-rs: the main program

## Testing & Verifiying

### Unit test

```bash
make test
```

### Test with VM

For details, please refer to the [README](./vagrant/README.md) in vagrant directory.

```bash
cd vagrant
vagrant up

# Set up will set up the namespaces and users
# and basic pings to verify connectivty
./setup.sh

# To show the namespaces and users setup
./show.sh

# To clean up
./setup.sh --clean

# To update the code and re-test
./update.sh
./setup.sh
```

# How to build wg-agent

## Generate api

```bash
make generate
```

## Compile

```bash
make build
```

## Optional steps

### How generate rust code from c code?

```bash
bindgen wrapper.h --whitelist-function 'ipc_.*|curve.*' --whitelist-type 'wgdevice|wgdevice_flag_wg_peer_flag_' --rustified-enum ".*" -- -I ~/wg-manager/wg-sys/wireguard-tools/src/uapi/linux  > src/lib.rs
```

### How to run test with output

```bash
 cargo test test_base58_curve25519 -- --show-output
```

## Code arch

- wg-sys: generated by the bindgen, don't change it manually
- wg-rs: wrapper for wg-sys, for wg
- wg-mgr-api: generated by swagger, a lib like the wg-sys, used by the wg-mgr-rs
- wg-mgr-rs: the main program

## Testing & Verifiying

Currently wg-agent support mannually testing and verifying, the following script can be used to test or verify:

- create_namespace[1-2].sh which is used to create a namespace, you can used it to create 2 namespaces
- delete_nameshapce.sh: delete a namespace, you have to change it to fill the namespace name
- create_user[_error].sh: create a user under a namespace;
- delete_user.sh: delete the user, you also need to provide the user name and the namespace name;
